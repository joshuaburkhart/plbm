<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><link rel="stylesheet" href="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /><title>Function details for parallel_function</title><link rel="stylesheet" href="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/matlab-report-styles.css" type="text/css" /></head><body bgcolor="#F8F8F8"><strong>This is a static copy of a profile report</strong><p><a href="file0.html">Home</a><p><span style="font-size:14pt; background:#FFE4B0">parallel_function (4 calls, 4996.503 sec)</span><br/><i>Generated 21-Feb-2012 21:22:08 using cpu time.</i><br/>function in file /ibrix/packages/MATLAB/R2011b/toolbox/matlab/lang/parallel_function.m<br/>Copy to new window for comparing multiple runs<div class="grayline"/><div class="grayline"/><strong>Parents</strong> (calling functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td></tr><tr><td class="td-linebottomrt"><a href="file3.html">IG_AmNat</a></td><td class="td-linebottomrt">script</td><td class="td-linebottomrt">4</td></tr></table><div class="grayline"/><strong>Lines where the most time was spent</strong><br/> <p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Line Number</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Code</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="#Line475">475</a></td><td class="td-linebottomrt"><pre>consume(base, limit, F(base, l...</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">4996.468 s</td><td class="td-linebottomrt" class="td-linebottomrt">100.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=100 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line315">315</a></td><td class="td-linebottomrt"><pre>cleanupObject = onCleanup( @()...</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.014 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line430">430</a></td><td class="td-linebottomrt"><pre>if W &gt; 0 &amp;&amp; PCTInst...</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.013 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line470">470</a></td><td class="td-linebottomrt"><pre>time1 = tic;</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="#Line518">518</a></td><td class="td-linebottomrt"><pre>varargout = results(nargout);</pre></td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.002 s</td><td class="td-linebottomrt" class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">All other lines</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">0.003 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">4996.503 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><b>Children</b> (called functions)<br/><p><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Name</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Function Type</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Calls</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Total Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">% Time</td><td class="td-linebottomrt" bgcolor="#F0F0F0">Time Plot</td></tr><tr><td class="td-linebottomrt"><a href="file19.html">fminsearch</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">8000</td><td class="td-linebottomrt">4995.313 s</td><td class="td-linebottomrt">100.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=100 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file54.html">distcomp.schema</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">0.009 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file58.html">onCleanup>onCleanup.delete</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.002 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file57.html">parallel_function>results</a></td><td class="td-linebottomrt">nested function</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.002 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file55.html">distcomp.remoteparfor.schema</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">1</td><td class="td-linebottomrt">0.001 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file31.html">parallel_function>PCTInstalled</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0.001 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file56.html">distcomp.remoteparfor.tryRemoteParfor</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file30.html">onCleanup>onCleanup.onCleanup</a></td><td class="td-linebottomrt">subfunction</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file28.html">...ab.incrementParallelFunctionDepth(-1)</a></td><td class="td-linebottomrt">anonymous function</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt"><a href="file27.html">incrementParallelFunctionDepth</a></td><td class="td-linebottomrt">function</td><td class="td-linebottomrt">4</td><td class="td-linebottomrt">0 s</td><td class="td-linebottomrt">0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt">Self time (built-ins, overhead, etc.)</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">&nbsp;</td><td class="td-linebottomrt">1.176 s</td><td class="td-linebottomrt">0.0%</td><td class="td-linebottomrt"><img src="file:////ibrix/packages/MATLAB/R2011b/toolbox/matlab/codetools/private/one-pixel.gif" width=0 height=10></td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Totals</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td><td class="td-linebottomrt" bgcolor="#F0F0F0">4996.503 s</td><td class="td-linebottomrt" bgcolor="#F0F0F0">100%</td><td class="td-linebottomrt" bgcolor="#F0F0F0">&nbsp;</td></tr></table><div class="grayline"/><strong>Code Analyzer results</strong><br/>No Code Analyzer messages.<div class="grayline"/><strong>Coverage results</strong><br/>[ Show coverage for parent directory ]<br/><table border=0 cellspacing=0 cellpadding=6><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Total lines in function</td><td class="td-linebottomrt">636</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Non-code lines (comments, blank lines)</td><td class="td-linebottomrt">400</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines (lines that can run)</td><td class="td-linebottomrt">236</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did run</td><td class="td-linebottomrt">57</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Code lines that did not run</td><td class="td-linebottomrt">179</td></tr><tr><td class="td-linebottomrt" bgcolor="#F0F0F0">Coverage (did run/can run)</td><td class="td-linebottomrt">24.15 %</td></tr></table><div class="grayline"/><b>Function listing</b><br/><pre> <span style="color: #FF0000; font-weight: bold; text-decoration: none">  time</span> <span style="color: #0000FF; font-weight: bold; text-decoration: none">  calls</span>  <span style="font-weight: bold; text-decoration: none">line</span><br/>               <span style="color: #A0A0A0">   1</span> <span style="color: #A0A0A0; background: #FFFFFF;">function varargout = parallel_function(range, F, consume, supply, ...</span><br/>               <span style="color: #A0A0A0">   2</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                       reduce, identity, concat, empty, ...</span><br/>               <span style="color: #A0A0A0">   3</span> <span style="color: #A0A0A0; background: #FFFFFF;">                                       M, divide, next_divide)</span><br/>               <span style="color: #A0A0A0">   4</span> <span style="color: #228B22; background: #FFFFFF;">%PARALLEL_FUNCTION</span><br/>               <span style="color: #A0A0A0">   5</span> <span style="color: #228B22; background: #FFFFFF;">%   This is the basis of parfor, but is not officially supported, either with</span><br/>               <span style="color: #A0A0A0">   6</span> <span style="color: #228B22; background: #FFFFFF;">%   this name or API.</span><br/>               <span style="color: #A0A0A0">   7</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">   8</span> <span style="color: #228B22; background: #FFFFFF;">%   Copyright 1984-2009 The MathWorks, Inc.</span><br/>               <span style="color: #A0A0A0">   9</span> <span style="color: #228B22; background: #FFFFFF;">%   $Revision $ $Date: 2009/04/15 23:20:50 $</span><br/>               <span style="color: #A0A0A0">  10</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  11</span> <span style="color: #228B22; background: #FFFFFF;">% The following is a help-style description of parallel_function.</span><br/>               <span style="color: #A0A0A0">  12</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0">  13</span> <span style="color: #228B22; background: #FFFFFF;">%PARALLEL_FUNCTION runs a function in parallel and consumes/reduces the results.</span><br/>               <span style="color: #A0A0A0">  14</span> <span style="color: #228B22; background: #FFFFFF;">%   PARALLEL_FUNCTION(RANGE, F) takes RANGE and a function handle F.  RANGE must</span><br/>               <span style="color: #A0A0A0">  15</span> <span style="color: #228B22; background: #FFFFFF;">%   be a two-element row vector of integers which we'll call BASE and LIMIT.</span><br/>               <span style="color: #A0A0A0">  16</span> <span style="color: #228B22; background: #FFFFFF;">%   These specify a semi-open interval (BASE,LIMIT].  If BASE &gt;= LIMIT, nothing</span><br/>               <span style="color: #A0A0A0">  17</span> <span style="color: #228B22; background: #FFFFFF;">%   happens because the interval is empty.  Otherwise, let N denote LIMIT-BASE,</span><br/>               <span style="color: #A0A0A0">  18</span> <span style="color: #228B22; background: #FFFFFF;">%   i.e., the interval includes N integers.  PARALLEL_FUNCTION chooses k-1</span><br/>               <span style="color: #A0A0A0">  19</span> <span style="color: #228B22; background: #FFFFFF;">%   intermediate points BASE &lt; N_1 &lt; ... &lt; N_{k-1} &lt; LIMIT, effectively dividing</span><br/>               <span style="color: #A0A0A0">  20</span> <span style="color: #228B22; background: #FFFFFF;">%   the interval into k segments.  (Control over choosing k and the N_j will be</span><br/>               <span style="color: #A0A0A0">  21</span> <span style="color: #228B22; background: #FFFFFF;">%   discussed below.)  We will use the convention that N_0 = BASE and</span><br/>               <span style="color: #A0A0A0">  22</span> <span style="color: #228B22; background: #FFFFFF;">%   N_k = LIMIT.  Independently of k and the intermediate N_j, (0,N] is the</span><br/>               <span style="color: #A0A0A0">  23</span> <span style="color: #228B22; background: #FFFFFF;">%   union of the subintervals (N_0,N_1],...,(N_{k-1},N_k].   PARALLEL_FUNCTION's</span><br/>               <span style="color: #A0A0A0">  24</span> <span style="color: #228B22; background: #FFFFFF;">%   essence:</span><br/>               <span style="color: #A0A0A0">  25</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  26</span> <span style="color: #228B22; background: #FFFFFF;">%     * In parallel, evaluate F(N_{j-1},N_j) in "worker" processes, j = 1,...,k.</span><br/>               <span style="color: #A0A0A0">  27</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  28</span> <span style="color: #228B22; background: #FFFFFF;">%   The process on which PARALLEL_FUNCTION is called the "client".</span><br/>               <span style="color: #A0A0A0">  29</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  30</span> <span style="color: #228B22; background: #FFFFFF;">%   Because the choice of intermediate points is non-deterministic,</span><br/>               <span style="color: #A0A0A0">  31</span> <span style="color: #228B22; background: #FFFFFF;">%   PARALLEL_FUNCTION will be non-deterministic unless F obeys the rule that the</span><br/>               <span style="color: #A0A0A0">  32</span> <span style="color: #228B22; background: #FFFFFF;">%   following statement sequences are equivalent:</span><br/>               <span style="color: #A0A0A0">  33</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  34</span> <span style="color: #228B22; background: #FFFFFF;">%     * F(N_{j-1}, N_j) % process a subinterval</span><br/>               <span style="color: #A0A0A0">  35</span> <span style="color: #228B22; background: #FFFFFF;">%       F(N_j, N_{j+1}) % process the next subinterval</span><br/>               <span style="color: #A0A0A0">  36</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  37</span> <span style="color: #228B22; background: #FFFFFF;">%     * F(N_{j-1}, N_{j+1}) % process the combined subintervals</span><br/>               <span style="color: #A0A0A0">  38</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  39</span> <span style="color: #228B22; background: #FFFFFF;">%   Because the order of processing is non-deterministic, PARALLEL_FUNCTION will</span><br/>               <span style="color: #A0A0A0">  40</span> <span style="color: #228B22; background: #FFFFFF;">%   be non-deterministic unless F obeys the rule that for any j1 and j2, these</span><br/>               <span style="color: #A0A0A0">  41</span> <span style="color: #228B22; background: #FFFFFF;">%   are equivalent:</span><br/>               <span style="color: #A0A0A0">  42</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  43</span> <span style="color: #228B22; background: #FFFFFF;">%     * F(N_{j1-1}, N_j1); F(N_{j2-1}, N_j2); % process j1 first</span><br/>               <span style="color: #A0A0A0">  44</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  45</span> <span style="color: #228B22; background: #FFFFFF;">%     * F(N_{j2-1}, N_j2); F(N_{j1-1}, N_j1); % process j2 first</span><br/>               <span style="color: #A0A0A0">  46</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  47</span> <span style="color: #228B22; background: #FFFFFF;">%   Actually, the requirement is stronger than this: the two statements here</span><br/>               <span style="color: #A0A0A0">  48</span> <span style="color: #228B22; background: #FFFFFF;">%   must not interfere with one another's execution.  For example, if they are</span><br/>               <span style="color: #A0A0A0">  49</span> <span style="color: #228B22; background: #FFFFFF;">%   both competing to write the same file, there will be trouble.  We will call</span><br/>               <span style="color: #A0A0A0">  50</span> <span style="color: #228B22; background: #FFFFFF;">%   this the "non-interference" rule.</span><br/>               <span style="color: #A0A0A0">  51</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  52</span> <span style="color: #228B22; background: #FFFFFF;">%   Not only N_{j-1} and N_j are sent from the client to the workers, but so is</span><br/>               <span style="color: #A0A0A0">  53</span> <span style="color: #228B22; background: #FFFFFF;">%   the function handle F.  Handles to nested functions are particularly useful</span><br/>               <span style="color: #A0A0A0">  54</span> <span style="color: #228B22; background: #FFFFFF;">%   as values of F, because the values in their workspace are sent along with F.</span><br/>               <span style="color: #A0A0A0">  55</span> <span style="color: #228B22; background: #FFFFFF;">%   This is the standard way to communicate loop-invariant values to workers.</span><br/>               <span style="color: #A0A0A0">  56</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  57</span> <span style="color: #228B22; background: #FFFFFF;">%   Note: PARALLEL_FUNCTION is the basis for PARFOR execution, and if PARFOR is</span><br/>               <span style="color: #A0A0A0">  58</span> <span style="color: #228B22; background: #FFFFFF;">%   sufficient for your purposes, it is a more convenient interface to this</span><br/>               <span style="color: #A0A0A0">  59</span> <span style="color: #228B22; background: #FFFFFF;">%   functionality.  PARFOR uses the nested function technique to transmit its</span><br/>               <span style="color: #A0A0A0">  60</span> <span style="color: #228B22; background: #FFFFFF;">%   unsliced input variables.</span><br/>               <span style="color: #A0A0A0">  61</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  62</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  63</span> <span style="color: #228B22; background: #FFFFFF;">%   PARALLEL_FUNCTION(RANGE, F, CONSUME) provides a way for workers to send</span><br/>               <span style="color: #A0A0A0">  64</span> <span style="color: #228B22; background: #FFFFFF;">%   values back to the client.  If CONSUME is [], the behavior is as above, i.e,</span><br/>               <span style="color: #A0A0A0">  65</span> <span style="color: #228B22; background: #FFFFFF;">%   F is evaluated with no expected results.  Otherwise, CONSUME must be a</span><br/>               <span style="color: #A0A0A0">  66</span> <span style="color: #228B22; background: #FFFFFF;">%   function handle, and F must return a result.  Each worker does this:</span><br/>               <span style="color: #A0A0A0">  67</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  68</span> <span style="color: #228B22; background: #FFFFFF;">%     * Evaluates O = F(N_{j-1}, N_j).</span><br/>               <span style="color: #A0A0A0">  69</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  70</span> <span style="color: #228B22; background: #FFFFFF;">%     * Sends O to the client.</span><br/>               <span style="color: #A0A0A0">  71</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  72</span> <span style="color: #228B22; background: #FFFFFF;">%   As each O is received, the client calls CONSUME(N_{j-1},N_j, O).</span><br/>               <span style="color: #A0A0A0">  73</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  74</span> <span style="color: #228B22; background: #FFFFFF;">%   Because the choice of intermediate points is non-deterministic,</span><br/>               <span style="color: #A0A0A0">  75</span> <span style="color: #228B22; background: #FFFFFF;">%   PARALLEL_FUNCTION will be non-deterministic unless F and consume obey the</span><br/>               <span style="color: #A0A0A0">  76</span> <span style="color: #228B22; background: #FFFFFF;">%   rule that the following statement sequences are equivalent:</span><br/>               <span style="color: #A0A0A0">  77</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  78</span> <span style="color: #228B22; background: #FFFFFF;">%     * O1 = F(N_{j-1}, N_j);      % process a subinterval</span><br/>               <span style="color: #A0A0A0">  79</span> <span style="color: #228B22; background: #FFFFFF;">%       O2 = F(N_j, N_{j+1});      % process the next subinterval</span><br/>               <span style="color: #A0A0A0">  80</span> <span style="color: #228B22; background: #FFFFFF;">%       CONSUME(N_{j-1}, N_j, O1)  % consume the first output</span><br/>               <span style="color: #A0A0A0">  81</span> <span style="color: #228B22; background: #FFFFFF;">%       CONSUME(N_j, N_{j+1}, O2)  % consume the second output</span><br/>               <span style="color: #A0A0A0">  82</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  83</span> <span style="color: #228B22; background: #FFFFFF;">%     * O = F(N_{j-1}, N_{j+1});     % process the combined subintervals</span><br/>               <span style="color: #A0A0A0">  84</span> <span style="color: #228B22; background: #FFFFFF;">%       CONSUME(N_{j-1}, N_{j+1}, O) % consume the entire output</span><br/>               <span style="color: #A0A0A0">  85</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  86</span> <span style="color: #228B22; background: #FFFFFF;">%   Because the order of processing is non-deterministic, PARALLEL_FUNCTION will</span><br/>               <span style="color: #A0A0A0">  87</span> <span style="color: #228B22; background: #FFFFFF;">%   be non-deterministic unless F obeys the non-interference rule, extended for</span><br/>               <span style="color: #A0A0A0">  88</span> <span style="color: #228B22; background: #FFFFFF;">%   outputs: for any distinct j1 and j2, the following may be executed</span><br/>               <span style="color: #A0A0A0">  89</span> <span style="color: #228B22; background: #FFFFFF;">%   concurrently:</span><br/>               <span style="color: #A0A0A0">  90</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  91</span> <span style="color: #228B22; background: #FFFFFF;">%     * O1 = F(N_{j1-1}, N_j1);</span><br/>               <span style="color: #A0A0A0">  92</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  93</span> <span style="color: #228B22; background: #FFFFFF;">%     * O2 = F(N_{j2-1}, N_j2)</span><br/>               <span style="color: #A0A0A0">  94</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0">  95</span> <span style="color: #228B22; background: #FFFFFF;">%   Calls on CONSUME occur in the client, and thus are serially executed.  Since</span><br/>               <span style="color: #A0A0A0">  96</span> <span style="color: #228B22; background: #FFFFFF;">%   the order in which this happens is not guaranteed, PARALLEL_FUNCTION will be</span><br/>               <span style="color: #A0A0A0">  97</span> <span style="color: #228B22; background: #FFFFFF;">%   non-deterministic unless CONSUME obeys the rule that for any j1 and j2, where</span><br/>               <span style="color: #A0A0A0">  98</span> <span style="color: #228B22; background: #FFFFFF;">%   O1 and O2 arise as above, these are equivalent:</span><br/>               <span style="color: #A0A0A0">  99</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 100</span> <span style="color: #228B22; background: #FFFFFF;">%     * CONSUME(N_{j1-1},N_j1, O1); CONSUME(N_{j2-1},N_j2, O2)</span><br/>               <span style="color: #A0A0A0"> 101</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 102</span> <span style="color: #228B22; background: #FFFFFF;">%     * CONSUME(N_{j2-1},N_j2, O2); CONSUME(N_{j1-1},N_j1, O1)</span><br/>               <span style="color: #A0A0A0"> 103</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 104</span> <span style="color: #228B22; background: #FFFFFF;">%   We say that CONSUME is "order-insensitive".</span><br/>               <span style="color: #A0A0A0"> 105</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 106</span> <span style="color: #228B22; background: #FFFFFF;">%   The final constraint comes from the observation that CONSUME runs on the</span><br/>               <span style="color: #A0A0A0"> 107</span> <span style="color: #228B22; background: #FFFFFF;">%   client and F on a worker, so there is an other form of the non-interference</span><br/>               <span style="color: #A0A0A0"> 108</span> <span style="color: #228B22; background: #FFFFFF;">%   requirement: for any distinct j1 and j2, the following may be executed</span><br/>               <span style="color: #A0A0A0"> 109</span> <span style="color: #228B22; background: #FFFFFF;">%   concurrently:</span><br/>               <span style="color: #A0A0A0"> 110</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 111</span> <span style="color: #228B22; background: #FFFFFF;">%     * O1 = F(N_{j1-1}, N_j1);</span><br/>               <span style="color: #A0A0A0"> 112</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 113</span> <span style="color: #228B22; background: #FFFFFF;">%     * CONSUME(N_{j2-1},N_j2, O2)</span><br/>               <span style="color: #A0A0A0"> 114</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 115</span> <span style="color: #228B22; background: #FFFFFF;">%   Note:  Even more so in this case, PARFOR is a convenient interface to this</span><br/>               <span style="color: #A0A0A0"> 116</span> <span style="color: #228B22; background: #FFFFFF;">%   functionality.  It uses CONSUME to implement its output sliced variables.</span><br/>               <span style="color: #A0A0A0"> 117</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 118</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 119</span> <span style="color: #228B22; background: #FFFFFF;">%   PARALLEL_FUNCTION(RANGE, F, CONSUME, SUPPLY) provides a way for the client</span><br/>               <span style="color: #A0A0A0"> 120</span> <span style="color: #228B22; background: #FFFFFF;">%   to send a worker a piece of data relevant only to its subinterval.  If</span><br/>               <span style="color: #A0A0A0"> 121</span> <span style="color: #228B22; background: #FFFFFF;">%   SUPPLY is [], the behavior is as above.  Otherwise, SUPPLY must be a</span><br/>               <span style="color: #A0A0A0"> 122</span> <span style="color: #228B22; background: #FFFFFF;">%   function handle (in practice, almost invariably to a nested function).</span><br/>               <span style="color: #A0A0A0"> 123</span> <span style="color: #228B22; background: #FFFFFF;">%   The client does the following:</span><br/>               <span style="color: #A0A0A0"> 124</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 125</span> <span style="color: #228B22; background: #FFFFFF;">%     * Evaluates I = SUPPLY(N_{j-1},N_j)</span><br/>               <span style="color: #A0A0A0"> 126</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 127</span> <span style="color: #228B22; background: #FFFFFF;">%     * Sends I to the worker along with N_{j-1} and N_j.</span><br/>               <span style="color: #A0A0A0"> 128</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 129</span> <span style="color: #228B22; background: #FFFFFF;">%   A worker evaluates F(N_{j-1}, N_j, I), with a result requested or not,</span><br/>               <span style="color: #A0A0A0"> 130</span> <span style="color: #228B22; background: #FFFFFF;">%   depending upon whether CONSUME is a function handle (as above).</span><br/>               <span style="color: #A0A0A0"> 131</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 132</span> <span style="color: #228B22; background: #FFFFFF;">%   Note: PARFOR uses SUPPLY for its sliced input variables.</span><br/>               <span style="color: #A0A0A0"> 133</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 134</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 135</span> <span style="color: #228B22; background: #FFFFFF;">%   R = PARALLEL_FUNCTION(RANGE, F, CONSUME, SUPPLY, REDUCE, IDENTITY)</span><br/>               <span style="color: #A0A0A0"> 136</span> <span style="color: #228B22; background: #FFFFFF;">%   A value of [] for REDUCE is ignored (same reason as for S), and will cause</span><br/>               <span style="color: #A0A0A0"> 137</span> <span style="color: #228B22; background: #FFFFFF;">%   IDENTITY to be ignored.  Otherwise, REDUCE must be a function handle and</span><br/>               <span style="color: #A0A0A0"> 138</span> <span style="color: #228B22; background: #FFFFFF;">%   IDENTITY must be present.  In this case, PARALLEL_FUNCTION returns a result,</span><br/>               <span style="color: #A0A0A0"> 139</span> <span style="color: #228B22; background: #FFFFFF;">%   computed as follows.  F is called in a worker with a "reduction" argument</span><br/>               <span style="color: #A0A0A0"> 140</span> <span style="color: #228B22; background: #FFFFFF;">%   and result (O is absent if CONSUME is [], and I is absent if SUPPLY is []):</span><br/>               <span style="color: #A0A0A0"> 141</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 142</span> <span style="color: #228B22; background: #FFFFFF;">%     * [O,Rout] = F(N_{j-1}, N_j, I, Rin);</span><br/>               <span style="color: #A0A0A0"> 143</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 144</span> <span style="color: #228B22; background: #FFFFFF;">%   For each call on PARALLEL_FUNCTION, the first time F is called in a worker,</span><br/>               <span style="color: #A0A0A0"> 145</span> <span style="color: #228B22; background: #FFFFFF;">%   Rin is IDENTITY.  On subsequent calls, Rin is the value of Rout on the</span><br/>               <span style="color: #A0A0A0"> 146</span> <span style="color: #228B22; background: #FFFFFF;">%   previous call.  As part of the termination of PARALLEL_FUNCTION, the client</span><br/>               <span style="color: #A0A0A0"> 147</span> <span style="color: #228B22; background: #FFFFFF;">%   informs each worker that there are no more subintervals.  In the presence of</span><br/>               <span style="color: #A0A0A0"> 148</span> <span style="color: #228B22; background: #FFFFFF;">%   REDUCE, a worker responds by transmitting its final value of Rout to the</span><br/>               <span style="color: #A0A0A0"> 149</span> <span style="color: #228B22; background: #FFFFFF;">%   client. Let the total number of workers be n, and denote the values of Rout</span><br/>               <span style="color: #A0A0A0"> 150</span> <span style="color: #228B22; background: #FFFFFF;">%   that the client sees be R1,...,Rn.  The client combines these value by</span><br/>               <span style="color: #A0A0A0"> 151</span> <span style="color: #228B22; background: #FFFFFF;">%   REDUCE, pairwise as the results come in, obtaining a final value R that</span><br/>               <span style="color: #A0A0A0"> 152</span> <span style="color: #228B22; background: #FFFFFF;">%   becomes the result of PARALLEL_FUNCTION.</span><br/>               <span style="color: #A0A0A0"> 153</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 154</span> <span style="color: #228B22; background: #FFFFFF;">%   Evidently, REDUCE must take two arguments and produce one result.  Because</span><br/>               <span style="color: #A0A0A0"> 155</span> <span style="color: #228B22; background: #FFFFFF;">%   the order in which it is called is non-deterministic, REDUCE and IDENTITY</span><br/>               <span style="color: #A0A0A0"> 156</span> <span style="color: #228B22; background: #FFFFFF;">%   should obey these laws:</span><br/>               <span style="color: #A0A0A0"> 157</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 158</span> <span style="color: #228B22; background: #FFFFFF;">%     * identity:    REDUCE(r, IDENTITY) = REDUCE(IDENTITY, r) = r</span><br/>               <span style="color: #A0A0A0"> 159</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 160</span> <span style="color: #228B22; background: #FFFFFF;">%     * commutative: REDUCE(r1,r2) = REDUCE(r2,r1)</span><br/>               <span style="color: #A0A0A0"> 161</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 162</span> <span style="color: #228B22; background: #FFFFFF;">%     * associative: REDUCE(r1,REDUCE(r2,r3)) = REDUCE(REDUCE(r1,r2),r3)</span><br/>               <span style="color: #A0A0A0"> 163</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 164</span> <span style="color: #228B22; background: #FFFFFF;">%   Further, because of the unpredictability of the particular N_j and how the</span><br/>               <span style="color: #A0A0A0"> 165</span> <span style="color: #228B22; background: #FFFFFF;">%   subintervals are sent to workers, the following statement sequences must</span><br/>               <span style="color: #A0A0A0"> 166</span> <span style="color: #228B22; background: #FFFFFF;">%   produce the same value for r:</span><br/>               <span style="color: #A0A0A0"> 167</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 168</span> <span style="color: #228B22; background: #FFFFFF;">%     * [O1, r1] = F(N_{j-1}, N_j, I, IDENTITY);  % done in one worker</span><br/>               <span style="color: #A0A0A0"> 169</span> <span style="color: #228B22; background: #FFFFFF;">%       [O2, r2] = F(N_j, N_{j+1}, I2, IDENTITY); % done in another worker</span><br/>               <span style="color: #A0A0A0"> 170</span> <span style="color: #228B22; background: #FFFFFF;">%       r = REDUCE(r1, r2);                       % combined in the client</span><br/>               <span style="color: #A0A0A0"> 171</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 172</span> <span style="color: #228B22; background: #FFFFFF;">%     * [O, r] = F(N_{j1-1}, N_j1, I1, IDENTITY); % done in one worker</span><br/>               <span style="color: #A0A0A0"> 173</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 174</span> <span style="color: #228B22; background: #FFFFFF;">%   REDUCE and F must also obey these laws:</span><br/>               <span style="color: #A0A0A0"> 175</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 176</span> <span style="color: #228B22; background: #FFFFFF;">%     * [O, r2] = F(N_{j-1}, N_j, I, r0); % start from arbitrary r0</span><br/>               <span style="color: #A0A0A0"> 177</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 178</span> <span style="color: #228B22; background: #FFFFFF;">%     * [O, r1] = F(N_{j-1}, N_j, I, IDENTITY); % start from IDENTITY</span><br/>               <span style="color: #A0A0A0"> 179</span> <span style="color: #228B22; background: #FFFFFF;">%       r2 = REDUCE(r0, r1);                    % combine with r0</span><br/>               <span style="color: #A0A0A0"> 180</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 181</span> <span style="color: #228B22; background: #FFFFFF;">%   A useful value of REDUCE is @plus, but there are others; see the PARFOR</span><br/>               <span style="color: #A0A0A0"> 182</span> <span style="color: #228B22; background: #FFFFFF;">%   documentation.  Also, note that for floating point numbers, @plus is only</span><br/>               <span style="color: #A0A0A0"> 183</span> <span style="color: #228B22; background: #FFFFFF;">%   approximately associative, so the errors introduced by it might vary from</span><br/>               <span style="color: #A0A0A0"> 184</span> <span style="color: #228B22; background: #FFFFFF;">%   run to run of the identical calls on PARALLEL_FUNCTION.</span><br/>               <span style="color: #A0A0A0"> 185</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 186</span> <span style="color: #228B22; background: #FFFFFF;">%   The server transmits the value of O to the client, as in the above cases.</span><br/>               <span style="color: #A0A0A0"> 187</span> <span style="color: #228B22; background: #FFFFFF;">%   For the first call on F in a server, the server simply hangs on to the value</span><br/>               <span style="color: #A0A0A0"> 188</span> <span style="color: #228B22; background: #FFFFFF;">%   of R.  In subsequent calls on F in the same server, the two values of R,</span><br/>               <span style="color: #A0A0A0"> 189</span> <span style="color: #228B22; background: #FFFFFF;">%   call them R1 and R2, are combined using REDUCE(R1, R2).  As part of</span><br/>               <span style="color: #A0A0A0"> 190</span> <span style="color: #228B22; background: #FFFFFF;">%   termination of the PARFOR loop in the worker, the final value of R is sent</span><br/>               <span style="color: #A0A0A0"> 191</span> <span style="color: #228B22; background: #FFFFFF;">%   to the client.</span><br/>               <span style="color: #A0A0A0"> 192</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 193</span> <span style="color: #228B22; background: #FFFFFF;">%   There is nothing you can do with REDUCE that cannot be done with CONSUME</span><br/>               <span style="color: #A0A0A0"> 194</span> <span style="color: #228B22; background: #FFFFFF;">%   alone.  However, the use of REDUCE can dramatically decrease communication</span><br/>               <span style="color: #A0A0A0"> 195</span> <span style="color: #228B22; background: #FFFFFF;">%   costs, because the size of its result may half the size of the sum of the</span><br/>               <span style="color: #A0A0A0"> 196</span> <span style="color: #228B22; background: #FFFFFF;">%   sizes of the inputs.</span><br/>               <span style="color: #A0A0A0"> 197</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 198</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 199</span> <span style="color: #228B22; background: #FFFFFF;">%   S = PARALLEL_FUNCTION(RANGE, F, CONSUME, SUPPLY, [], [], CONCAT, EMPTY)</span><br/>               <span style="color: #A0A0A0"> 200</span> <span style="color: #228B22; background: #FFFFFF;">%   [R, S] = PARALLEL_FUNCTION(RANGE, F, CONSUME, SUPPLY, REDUCE, IDENTITY,</span><br/>               <span style="color: #A0A0A0"> 201</span> <span style="color: #228B22; background: #FFFFFF;">%                              CONCAT, EMPTY)</span><br/>               <span style="color: #A0A0A0"> 202</span> <span style="color: #228B22; background: #FFFFFF;">%   CONCAT and EMPTY work in a way that is similar to REDUCE and IDENTITY,</span><br/>               <span style="color: #A0A0A0"> 203</span> <span style="color: #228B22; background: #FFFFFF;">%   except that CONCAT is not required to be commutative.  (The argument takes</span><br/>               <span style="color: #A0A0A0"> 204</span> <span style="color: #228B22; background: #FFFFFF;">%   its name from the fact that ordinary concatenation is associative but not</span><br/>               <span style="color: #A0A0A0"> 205</span> <span style="color: #228B22; background: #FFFFFF;">%   commutative.  Matrix multiply is another such function.)  CONCAT is given</span><br/>               <span style="color: #A0A0A0"> 206</span> <span style="color: #228B22; background: #FFFFFF;">%   arguments that come only from contiguous subintervals (N_{j-1},N_j] and</span><br/>               <span style="color: #A0A0A0"> 207</span> <span style="color: #228B22; background: #FFFFFF;">%   (N_j,N_{j+1}].  If CONCAT is non-empty, F is called in a worker with an</span><br/>               <span style="color: #A0A0A0"> 208</span> <span style="color: #228B22; background: #FFFFFF;">%   expected result, the we'll denote S, but unlike REDUCE, without a</span><br/>               <span style="color: #A0A0A0"> 209</span> <span style="color: #228B22; background: #FFFFFF;">%   corresponding input argument.</span><br/>               <span style="color: #A0A0A0"> 210</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 211</span> <span style="color: #228B22; background: #FFFFFF;">%     * [O, R, S] = F(N_{j-1}, N_j, I, R);</span><br/>               <span style="color: #A0A0A0"> 212</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 213</span> <span style="color: #228B22; background: #FFFFFF;">%   O is absent if CONSUME is [], I is absent if SUPPLY is [], and R is absent</span><br/>               <span style="color: #A0A0A0"> 214</span> <span style="color: #228B22; background: #FFFFFF;">%   (in both result and argument lists) if REDUCE is [].</span><br/>               <span style="color: #A0A0A0"> 215</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 216</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 217</span> <span style="color: #228B22; background: #FFFFFF;">%   ... = PARALLEL_FUNCTION(RANGE, F, CONSUME, SUPPLY, REDUCE, IDENTITY,</span><br/>               <span style="color: #A0A0A0"> 218</span> <span style="color: #228B22; background: #FFFFFF;">%                           CONCAT, EMPTY, M)</span><br/>               <span style="color: #A0A0A0"> 219</span> <span style="color: #228B22; background: #FFFFFF;">%   (Results are supplied by the whether REDUCE and CONCAT are empty, as above.)</span><br/>               <span style="color: #A0A0A0"> 220</span> <span style="color: #228B22; background: #FFFFFF;">%   The next argument is either a number M specifying the desired number of</span><br/>               <span style="color: #A0A0A0"> 221</span> <span style="color: #228B22; background: #FFFFFF;">%   workers.  The default value of M is inf, meaning "use as many workers as are</span><br/>               <span style="color: #A0A0A0"> 222</span> <span style="color: #228B22; background: #FFFFFF;">%   available, up to N."  If you specify M, it must be a positive integer or</span><br/>               <span style="color: #A0A0A0"> 223</span> <span style="color: #228B22; background: #FFFFFF;">%   inf.  PARALLEL_FUNCTION will try to reserve min(N,M) workers.  In the</span><br/>               <span style="color: #A0A0A0"> 224</span> <span style="color: #228B22; background: #FFFFFF;">%   subsequent discussion W will denote the number of workers actually reserved,</span><br/>               <span style="color: #A0A0A0"> 225</span> <span style="color: #228B22; background: #FFFFFF;">%   so W &lt;= min(N,M) &lt;= N.</span><br/>               <span style="color: #A0A0A0"> 226</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 227</span> <span style="color: #228B22; background: #FFFFFF;">%   In all cases, this argument, in combination with , determines a set of</span><br/>               <span style="color: #A0A0A0"> 228</span> <span style="color: #228B22; background: #FFFFFF;">%   workers for this invocation of PARALLEL_FUNCTION.  At the end of the</span><br/>               <span style="color: #A0A0A0"> 229</span> <span style="color: #228B22; background: #FFFFFF;">%   computation, all reserved workers are released.</span><br/>               <span style="color: #A0A0A0"> 230</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 231</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 232</span> <span style="color: #228B22; background: #FFFFFF;">%   ... = PARALLEL_FUNCTION(RANGE, F, CONSUME, SUPPLY, REDUCE, IDENTITY,</span><br/>               <span style="color: #A0A0A0"> 233</span> <span style="color: #228B22; background: #FFFFFF;">%                           CONCAT, EMPTY, M, DIVIDE)</span><br/>               <span style="color: #A0A0A0"> 234</span> <span style="color: #228B22; background: #FFFFFF;">%   (Results are supplied by the whether REDUCE and CONCAT are empty, as above.)</span><br/>               <span style="color: #A0A0A0"> 235</span> <span style="color: #228B22; background: #FFFFFF;">%   The role of DIVIDE is to choose N_1, N_2,... .  If DIVIDE is numeric, it</span><br/>               <span style="color: #A0A0A0"> 236</span> <span style="color: #228B22; background: #FFFFFF;">%   must be scalar and at least 1; call this value D.  In this case, the N_i</span><br/>               <span style="color: #A0A0A0"> 237</span> <span style="color: #228B22; background: #FFFFFF;">%   are chosen by dividing RANGE into k = min(N,D*W) pieces as uniformly as</span><br/>               <span style="color: #A0A0A0"> 238</span> <span style="color: #228B22; background: #FFFFFF;">%   possible.  (The requirement that D is at least one guarantees that</span><br/>               <span style="color: #A0A0A0"> 239</span> <span style="color: #228B22; background: #FFFFFF;">%   W &lt;= k &lt;= N.)  If the computation time for each call on F is closely</span><br/>               <span style="color: #A0A0A0"> 240</span> <span style="color: #228B22; background: #FFFFFF;">%   proportional to the size of the interval for the call, then the best value</span><br/>               <span style="color: #A0A0A0"> 241</span> <span style="color: #228B22; background: #FFFFFF;">%   of D is 1.  But if the times are uneven, then larger values are better---</span><br/>               <span style="color: #A0A0A0"> 242</span> <span style="color: #228B22; background: #FFFFFF;">%   they keep all the workers busy, at the cost of more communication.</span><br/>               <span style="color: #A0A0A0"> 243</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 244</span> <span style="color: #228B22; background: #FFFFFF;">%   If DIVIDE is not number, it must be a function handle.  If it takes one</span><br/>               <span style="color: #A0A0A0"> 245</span> <span style="color: #228B22; background: #FFFFFF;">%   argument (as determined by NARGIN), then PARALLEL_FUNCTION calls it as</span><br/>               <span style="color: #A0A0A0"> 246</span> <span style="color: #228B22; background: #FFFFFF;">%   follows:</span><br/>               <span style="color: #A0A0A0"> 247</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 248</span> <span style="color: #228B22; background: #FFFFFF;">%     * k = min(N, max(W, DIVIDE(N))); % again, note W &lt;= k &lt;= N.</span><br/>               <span style="color: #A0A0A0"> 249</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 250</span> <span style="color: #228B22; background: #FFFFFF;">%   As before, the N_i are chosen to divide (BASE,LIMIT] as evenly as possible</span><br/>               <span style="color: #A0A0A0"> 251</span> <span style="color: #228B22; background: #FFFFFF;">%   into k subintervals.</span><br/>               <span style="color: #A0A0A0"> 252</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 253</span> <span style="color: #228B22; background: #FFFFFF;">%   If DIVIDE takes two arguments, it is called as follows:</span><br/>               <span style="color: #A0A0A0"> 254</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 255</span> <span style="color: #228B22; background: #FFFFFF;">%     * k = min(N, max(W, DIVIDE(N, W))); % again, note W &lt;= k &lt;= N.</span><br/>               <span style="color: #A0A0A0"> 256</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 257</span> <span style="color: #228B22; background: #FFFFFF;">%   The result k is used as before.</span><br/>               <span style="color: #A0A0A0"> 258</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 259</span> <span style="color: #228B22; background: #FFFFFF;">%   If DIVIDE does not take one or two arguments, it must take three, in which</span><br/>               <span style="color: #A0A0A0"> 260</span> <span style="color: #228B22; background: #FFFFFF;">%   case PARALLEL_FUNCTION calls it as follows:</span><br/>               <span style="color: #A0A0A0"> 261</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 262</span> <span style="color: #228B22; background: #FFFFFF;">%     * NN = DIVIDE(BASE, LIMIT, W)</span><br/>               <span style="color: #A0A0A0"> 263</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 264</span> <span style="color: #228B22; background: #FFFFFF;">%       - NN is a row vector, where NN(j) plays the role of N_j above.  Thus,</span><br/>               <span style="color: #A0A0A0"> 265</span> <span style="color: #228B22; background: #FFFFFF;">%         elements of NN must be positive, strictly increasing, and between</span><br/>               <span style="color: #A0A0A0"> 266</span> <span style="color: #228B22; background: #FFFFFF;">%         BASE and LIMIT.  The length of NN must be at least W.  If</span><br/>               <span style="color: #A0A0A0"> 267</span> <span style="color: #228B22; background: #FFFFFF;">%         NN(end) == LIMIT, then NN completely partitions (BASE,LIMIT], or</span><br/>               <span style="color: #A0A0A0"> 268</span> <span style="color: #228B22; background: #FFFFFF;">%         equivalently, the length of NN is what we have denoted by k.  In this</span><br/>               <span style="color: #A0A0A0"> 269</span> <span style="color: #228B22; background: #FFFFFF;">%         case, DIVIDE is allowed to be the last argument.  Otherwise, the next</span><br/>               <span style="color: #A0A0A0"> 270</span> <span style="color: #228B22; background: #FFFFFF;">%         argument is required; see below.</span><br/>               <span style="color: #A0A0A0"> 271</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 272</span> <span style="color: #228B22; background: #FFFFFF;">%</span><br/>               <span style="color: #A0A0A0"> 273</span> <span style="color: #228B22; background: #FFFFFF;">%   ... = PARALLEL_FUNCTION(N, F, CONSUME, SUPPLY, REDUCE, IDENTITY,</span><br/>               <span style="color: #A0A0A0"> 274</span> <span style="color: #228B22; background: #FFFFFF;">%                           CONCAT, EMPTY, M, DIVIDE, NEXT_DIVIDE)</span><br/>               <span style="color: #A0A0A0"> 275</span> <span style="color: #228B22; background: #FFFFFF;">%   (Results are supplied by the whether REDUCE and CONCAT are empty, as above.)</span><br/>               <span style="color: #A0A0A0"> 276</span> <span style="color: #228B22; background: #FFFFFF;">%   The purpose of NEXT_DIVIDE is to allow you to write an adaptive scheduler.  It</span><br/>               <span style="color: #A0A0A0"> 277</span> <span style="color: #228B22; background: #FFFFFF;">%   must be a function handle, and is called only when DIVIDE (which is called</span><br/>               <span style="color: #A0A0A0"> 278</span> <span style="color: #228B22; background: #FFFFFF;">%   only once per invocation of PARALLEL_DIVIDE) and all previous calls of</span><br/>               <span style="color: #A0A0A0"> 279</span> <span style="color: #228B22; background: #FFFFFF;">%   NEXT_DIVIDE have not specified the partition all the way to N.  NEXT_DIVIDE</span><br/>               <span style="color: #A0A0A0"> 280</span> <span style="color: #228B22; background: #FFFFFF;">%   takes an argument that supplies a summary of the computation so far, which is</span><br/>               <span style="color: #A0A0A0"> 281</span> <span style="color: #228B22; background: #FFFFFF;">%   what allows it to be adaptive.</span><br/>               <span style="color: #A0A0A0"> 282</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 283</span> <span style="color: #228B22; background: #FFFFFF;">%   The details are that PARALLEL_FUNCTION calls this argument as follows:</span><br/>               <span style="color: #A0A0A0"> 284</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 285</span> <span style="color: #228B22; background: #FFFFFF;">%     * NN_EXT = NEXT_DIVIDE(PREV_N, N, L_EXT, HISTORY)</span><br/>               <span style="color: #A0A0A0"> 286</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 287</span> <span style="color: #228B22; background: #FFFFFF;">%       - PREV_N is the endpoint of the last specified subinterval.</span><br/>               <span style="color: #A0A0A0"> 288</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 289</span> <span style="color: #228B22; background: #FFFFFF;">%       - N is the same as usual, so the task is to divide up (PREV_N,N].</span><br/>               <span style="color: #A0A0A0"> 290</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 291</span> <span style="color: #228B22; background: #FFFFFF;">%       - L_EXT specifies the minimum length of the result.  It is guaranteed that</span><br/>               <span style="color: #A0A0A0"> 292</span> <span style="color: #228B22; background: #FFFFFF;">%         N - PREV_N &gt;= L_EXT.</span><br/>               <span style="color: #A0A0A0"> 293</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 294</span> <span style="color: #228B22; background: #FFFFFF;">%       - HISTORY is a cell of length L (the number of workers), where HISTORY(j)</span><br/>               <span style="color: #A0A0A0"> 295</span> <span style="color: #228B22; background: #FFFFFF;">%         is a 3 column array with one row for each subinterval sent to server j.</span><br/>               <span style="color: #A0A0A0"> 296</span> <span style="color: #228B22; background: #FFFFFF;">%         The first two columns are the endpoints of the interval, and the third</span><br/>               <span style="color: #A0A0A0"> 297</span> <span style="color: #228B22; background: #FFFFFF;">%         column is the time spent processing that subinterval, or zero it has</span><br/>               <span style="color: #A0A0A0"> 298</span> <span style="color: #228B22; background: #FFFFFF;">%         not yet finished.</span><br/>               <span style="color: #A0A0A0"> 299</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 300</span> <span style="color: #228B22; background: #FFFFFF;">%       - NN_EXT must be an extension to the partition specified so far.  It must</span><br/>               <span style="color: #A0A0A0"> 301</span> <span style="color: #228B22; background: #FFFFFF;">%         be a non-empty row vector of length at least L_EXT, where</span><br/>               <span style="color: #A0A0A0"> 302</span> <span style="color: #228B22; background: #FFFFFF;">%         PREV_N &lt; NN_EXT(1), elements are strictly increasing, and</span><br/>               <span style="color: #A0A0A0"> 303</span> <span style="color: #228B22; background: #FFFFFF;">%         NN_EXT(end) &lt;= N.  There will be no more calls on NEXT_DIVIDE if and</span><br/>               <span style="color: #A0A0A0"> 304</span> <span style="color: #228B22; background: #FFFFFF;">%         only if NN_EXT(end) == N.</span><br/>               <span style="color: #A0A0A0"> 305</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 306</span> <span style="color: #228B22; background: #FFFFFF;">% </span><br/>               <span style="color: #A0A0A0"> 307</span> <span style="color: #228B22; background: #FFFFFF;">%   [...,HISTORY] = PARALLEL_FUNCTION(N, F, CONSUME, ...)  The HISTORY result has</span><br/>               <span style="color: #A0A0A0"> 308</span> <span style="color: #228B22; background: #FFFFFF;">%   (The "..." results are supplied by the whether REDUCE and CONCAT are empty, as</span><br/>               <span style="color: #A0A0A0"> 309</span> <span style="color: #228B22; background: #FFFFFF;">%   above.)  The same structure as the HISTORY argument to NEXT_DIVIDE, except</span><br/>               <span style="color: #A0A0A0"> 310</span> <span style="color: #228B22; background: #FFFFFF;">%   that none of the time entries (in the third columns) will be zero, because all</span><br/>               <span style="color: #A0A0A0"> 311</span> <span style="color: #228B22; background: #FFFFFF;">%   computations have been finished.</span><br/>               <span style="color: #A0A0A0"> 312</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 313</span> <span style="color: #228B22; background: #FFFFFF;">% Indicate that we are entering this function</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 314</span> <span style="color: #000000; background: #FFFFFF;">internal.matlab.<a href="file27.html">incrementParallelFunctionDepth</a>(1); </span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 315</span> <a name="Line315"></a><span style="color: #000000; background: #FFFFFF;">cleanupObject = onCleanup( @() internal.matlab.<a href="file27.html">incrementParallelFunctionDepth</a>(-1) ); </span><br/>               <span style="color: #A0A0A0"> 316</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 317</span> <span style="color: #000000; background: #FFFFFF;">if nargin &lt; 2 </span><br/>               <span style="color: #A0A0A0"> 318</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:ArgumentMissing', 'The RANGE and F arguments are required.')</span><br/>               <span style="color: #A0A0A0"> 319</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 320</span> <span style="color: #228B22; background: #FFFFFF;">% Validate range</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 321</span> <span style="color: #000000; background: #FFFFFF;">if ~isequal(size(range), [1 2]) || ~isnumeric(range) </span><br/>               <span style="color: #A0A0A0"> 322</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidArgument', 'RANGE must be a row vector with length 2, of numerics.')</span><br/>               <span style="color: #A0A0A0"> 323</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 324</span> <span style="color: #000000; background: #FFFFFF;">base = range(1)-1; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 325</span> <span style="color: #000000; background: #FFFFFF;">limit = range(2); </span><br/>               <span style="color: #A0A0A0"> 326</span> <span style="color: #228B22; background: #FFFFFF;">% Validate base and limit</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 327</span> <span style="color: #000000; background: #FFFFFF;">if ~isreal(base) || ~isreal(limit) </span><br/>               <span style="color: #A0A0A0"> 328</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidArgument', 'BASE and LIMIT arguments must be real.')</span><br/>               <span style="color: #A0A0A0"> 329</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 330</span> <span style="color: #000000; background: #FFFFFF;">if base ~= round(base) || limit ~= round(limit) </span><br/>               <span style="color: #A0A0A0"> 331</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidArgument', 'BASE and LIMIT arguments must be integers.')</span><br/>               <span style="color: #A0A0A0"> 332</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 333</span> <span style="color: #000000; background: #FFFFFF;">N = double(limit - base); % Allows arbitrary arithmetic functions of N </span><br/>               <span style="color: #A0A0A0"> 334</span> <span style="color: #228B22; background: #FFFFFF;">% Validate F</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 335</span> <span style="color: #000000; background: #FFFFFF;">if ~isa(F, 'function_handle') </span><br/>               <span style="color: #A0A0A0"> 336</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidArgument', 'F must be a function handle.');</span><br/>               <span style="color: #A0A0A0"> 337</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 338</span> <span style="color: #228B22; background: #FFFFFF;">% The empty/function-handle status of consume, supply, and reduce is encoded in a single</span><br/>               <span style="color: #A0A0A0"> 339</span> <span style="color: #228B22; background: #FFFFFF;">% integer consume_supply_reduce as bit vector with mask bits:</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 340</span> <span style="color: #000000; background: #FFFFFF;">consume_bit = 1; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 341</span> <span style="color: #000000; background: #FFFFFF;">supply_bit  = 2; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 342</span> <span style="color: #000000; background: #FFFFFF;">reduce_bit  = 4; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 343</span> <span style="color: #000000; background: #FFFFFF;">concat_bit  = 8; </span><br/>               <span style="color: #A0A0A0"> 344</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 345</span> <span style="color: #000000; background: #FFFFFF;">consume_supply_reduce_concat = 0; </span><br/>               <span style="color: #A0A0A0"> 346</span> <span style="color: #228B22; background: #FFFFFF;">% Validate consume</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 347</span> <span style="color: #000000; background: #FFFFFF;">if nargin &gt;= 3 &amp;&amp; ~isempty(consume) </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 348</span> <span style="color: #000000; background: #FFFFFF;">    if ~isa(consume, 'function_handle') </span><br/>               <span style="color: #A0A0A0"> 349</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'CONSUME must be a function handle or [].');</span><br/>               <span style="color: #A0A0A0"> 350</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 351</span> <span style="color: #000000; background: #FFFFFF;">    consume_supply_reduce_concat = consume_supply_reduce_concat + consume_bit; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 352</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 353</span> <span style="color: #228B22; background: #FFFFFF;">% Validate supply</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 354</span> <span style="color: #000000; background: #FFFFFF;">if nargin &gt;= 4 &amp;&amp; ~isempty(supply) </span><br/>               <span style="color: #A0A0A0"> 355</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if ~isa(supply, 'function_handle')</span><br/>               <span style="color: #A0A0A0"> 356</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'SUPPLY must be a function handle or [].');</span><br/>               <span style="color: #A0A0A0"> 357</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 358</span> <span style="color: #A0A0A0; background: #FFFFFF;">    consume_supply_reduce_concat = consume_supply_reduce_concat + supply_bit;</span><br/>               <span style="color: #A0A0A0"> 359</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 360</span> <span style="color: #228B22; background: #FFFFFF;">% Validate reduce and identity</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 361</span> <span style="color: #000000; background: #FFFFFF;">if nargin &gt;= 5 &amp;&amp; ~isempty(reduce) </span><br/>               <span style="color: #A0A0A0"> 362</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if ~isa(reduce, 'function_handle')</span><br/>               <span style="color: #A0A0A0"> 363</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'REDUCE must be a function handle or [].');</span><br/>               <span style="color: #A0A0A0"> 364</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 365</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if nargin == 5</span><br/>               <span style="color: #A0A0A0"> 366</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:ArgumentMissing', 'If REDUCE is a function handle, IDENTITY must be supplied')</span><br/>               <span style="color: #A0A0A0"> 367</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 368</span> <span style="color: #A0A0A0; background: #FFFFFF;">    R = identity;</span><br/>               <span style="color: #A0A0A0"> 369</span> <span style="color: #A0A0A0; background: #FFFFFF;">    consume_supply_reduce_concat = consume_supply_reduce_concat + reduce_bit;</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 370</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 371</span> <span style="color: #000000; background: #FFFFFF;">    reduce = [];   % solely for the ... </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 372</span> <span style="color: #000000; background: #FFFFFF;">    identity =  0; % ... benefit of ... </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 373</span> <span style="color: #000000; background: #FFFFFF;">    R = identity;  % ... distributed_execution. </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 374</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 375</span> <span style="color: #228B22; background: #FFFFFF;">% Validate concat and empty</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 376</span> <span style="color: #000000; background: #FFFFFF;">if nargin &gt;= 7 &amp;&amp; ~isempty(concat) </span><br/>               <span style="color: #A0A0A0"> 377</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if ~isa(concat, 'function_handle')</span><br/>               <span style="color: #A0A0A0"> 378</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'CONCAT must be a function handle or [].');</span><br/>               <span style="color: #A0A0A0"> 379</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 380</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if nargin == 7</span><br/>               <span style="color: #A0A0A0"> 381</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:ArgumentMissing', 'If CONCAT is a function handle, EMPTY must be supplied')</span><br/>               <span style="color: #A0A0A0"> 382</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 383</span> <span style="color: #A0A0A0; background: #FFFFFF;">    S = empty;</span><br/>               <span style="color: #A0A0A0"> 384</span> <span style="color: #A0A0A0; background: #FFFFFF;">    consume_supply_reduce_concat = consume_supply_reduce_concat + concat_bit;</span><br/>               <span style="color: #A0A0A0"> 385</span> <span style="color: #A0A0A0; background: #FFFFFF;">    concatenator = online_concatenator(concat, empty);</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 386</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 387</span> <span style="color: #000000; background: #FFFFFF;">    empty = []; % solely for the benefit of empty loops. </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 388</span> <span style="color: #000000; background: #FFFFFF;">    concatenator = []; % solely for the benefit of distributed_execution </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 389</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 390</span> <span style="color: #228B22; background: #FFFFFF;">% Validate M</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 391</span> <span style="color: #000000; background: #FFFFFF;">if nargin &gt;= 9 </span><br/>               <span style="color: #A0A0A0"> 392</span> <span style="color: #228B22; background: #FFFFFF;">    % This still omits the case when M is an MUE vector.</span><br/>               <span style="color: #A0A0A0"> 393</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if isequal(M, 'debug')</span><br/>               <span style="color: #A0A0A0"> 394</span> <span style="color: #A0A0A0; background: #FFFFFF;">        M = max(1, floor(log2(N)));</span><br/>               <span style="color: #A0A0A0"> 395</span> <span style="color: #A0A0A0; background: #FFFFFF;">        debug = true;</span><br/>               <span style="color: #A0A0A0"> 396</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif isnumeric(M) &amp;&amp; isscalar(M) &amp;&amp; M == round(M) &amp;&amp;  M &gt;= 0</span><br/>               <span style="color: #A0A0A0"> 397</span> <span style="color: #A0A0A0; background: #FFFFFF;">        M = double(M);</span><br/>               <span style="color: #A0A0A0"> 398</span> <span style="color: #A0A0A0; background: #FFFFFF;">        debug = false;</span><br/>               <span style="color: #A0A0A0"> 399</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 400</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'The M argument must be zero or a positive scalar integer.')</span><br/>               <span style="color: #A0A0A0"> 401</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 402</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 403</span> <span style="color: #000000; background: #FFFFFF;">    M = Inf; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 404</span> <span style="color: #000000; background: #FFFFFF;">    debug = false; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 405</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 406</span> <span style="color: #228B22; background: #FFFFFF;">% The number of workers.</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 407</span> <span style="color: #000000; background: #FFFFFF;">W = min(M, N); % no point in having more workers than the range needs </span><br/>               <span style="color: #A0A0A0"> 408</span> <span style="color: #228B22; background: #FFFFFF;">% Validate nargout</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 409</span> <span style="color: #000000; background: #FFFFFF;">if nargout &gt; 3 </span><br/>               <span style="color: #A0A0A0"> 410</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidOutputArgument', 'At most three results are possible.')</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 411</span> <span style="color: #000000; background: #FFFFFF;">elseif nargout &gt; 2 ... </span><br/>               <span style="color: #A0A0A0"> 412</span> <span style="color: #000000; background: #FFFFFF;">        &amp;&amp; (bitand(consume_supply_reduce_concat, reduce_bit) == 0 ...</span><br/>               <span style="color: #A0A0A0"> 413</span> <span style="color: #000000; background: #FFFFFF;">            || bitand(consume_supply_reduce_concat, concat_bit) == 0)</span><br/>               <span style="color: #A0A0A0"> 414</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidOutputArgument', 'To obtain three results requires both REDUCE and CONCAT arguments.');</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 415</span> <span style="color: #000000; background: #FFFFFF;">elseif nargout &gt; 1 ... </span><br/>               <span style="color: #A0A0A0"> 416</span> <span style="color: #000000; background: #FFFFFF;">        &amp;&amp; bitand(consume_supply_reduce_concat, reduce_bit) == 0 ...</span><br/>               <span style="color: #A0A0A0"> 417</span> <span style="color: #000000; background: #FFFFFF;">        &amp;&amp; bitand(consume_supply_reduce_concat, concat_bit) == 0</span><br/>               <span style="color: #A0A0A0"> 418</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:InvalidOutputArgument', 'To obtain two results requires either a REDUCE or a CONCAT argument.')</span><br/>               <span style="color: #A0A0A0"> 419</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 420</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 421</span> <span style="color: #000000; background: #FFFFFF;">if N &lt;= 0 </span><br/>               <span style="color: #A0A0A0"> 422</span> <span style="color: #A0A0A0; background: #FFFFFF;">    S = empty;</span><br/>               <span style="color: #A0A0A0"> 423</span> <span style="color: #A0A0A0; background: #FFFFFF;">    history = cell(1, 0); % needed by the next statement</span><br/>               <span style="color: #A0A0A0"> 424</span> <span style="color: #A0A0A0; background: #FFFFFF;">    varargout = results(nargout);</span><br/>               <span style="color: #A0A0A0"> 425</span> <span style="color: #A0A0A0; background: #FFFFFF;">    return</span><br/>               <span style="color: #A0A0A0"> 426</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 427</span> <span style="color: #228B22; background: #FFFFFF;">% If the number of workers requested is zero then even if DCT is installed</span><br/>               <span style="color: #A0A0A0"> 428</span> <span style="color: #228B22; background: #FFFFFF;">% and there is a matlabpool session running we will still run the loop</span><br/>               <span style="color: #A0A0A0"> 429</span> <span style="color: #228B22; background: #FFFFFF;">% on the client.</span><br/><span style="color: #FF0000">  0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 430</span> <a name="Line430"></a><span style="color: #000000; background: #FFFFFF;">if W &gt; 0 &amp;&amp; <a href="file31.html">PCTInstalled</a> &amp;&amp; distcomp.remoteparfor.tryRemoteParfor </span><br/>               <span style="color: #A0A0A0"> 431</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if logical(bitand(consume_supply_reduce_concat, reduce_bit))</span><br/>               <span style="color: #A0A0A0"> 432</span> <span style="color: #A0A0A0; background: #FFFFFF;">        parfor_C = {consume_supply_reduce_concat, F, identity};</span><br/>               <span style="color: #A0A0A0"> 433</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 434</span> <span style="color: #A0A0A0; background: #FFFFFF;">        parfor_C = {consume_supply_reduce_concat, F};</span><br/>               <span style="color: #A0A0A0"> 435</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 436</span> <span style="color: #A0A0A0; background: #FFFFFF;">    try</span><br/>               <span style="color: #A0A0A0"> 437</span> <span style="color: #A0A0A0; background: #FFFFFF;">        P = distcomp.remoteparfor(W, @make_channel, parfor_C);</span><br/>               <span style="color: #A0A0A0"> 438</span> <span style="color: #A0A0A0; background: #FFFFFF;">        W = P.NumWorkers; % revise for actual number obtained</span><br/>               <span style="color: #A0A0A0"> 439</span> <span style="color: #A0A0A0; background: #FFFFFF;">    catch E</span><br/>               <span style="color: #A0A0A0"> 440</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if strcmp( E.identifier, 'distcomp:remoteparfor:IllegalComposite' )</span><br/>               <span style="color: #A0A0A0"> 441</span> <span style="color: #228B22; background: #FFFFFF;">            % In this case, we wish to abort parfor execution</span><br/>               <span style="color: #A0A0A0"> 442</span> <span style="color: #A0A0A0; background: #FFFFFF;">            E2 = MException( 'MATLAB:parfor:InvalidComposite', ...</span><br/>               <span style="color: #A0A0A0"> 443</span> <span style="color: #A0A0A0; background: #FFFFFF;">                            'It is illegal to use a Composite within the body of a parfor loop' );</span><br/>               <span style="color: #A0A0A0"> 444</span> <span style="color: #A0A0A0; background: #FFFFFF;">            E2 = addCause( E2, E );</span><br/>               <span style="color: #A0A0A0"> 445</span> <span style="color: #A0A0A0; background: #FFFFFF;">            throw( E2 );</span><br/>               <span style="color: #A0A0A0"> 446</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 447</span> <span style="color: #228B22; background: #FFFFFF;">            % There are circumstances where we try to make a remoteparfor</span><br/>               <span style="color: #A0A0A0"> 448</span> <span style="color: #228B22; background: #FFFFFF;">            % controller and it throws an error (because it fails to acquire</span><br/>               <span style="color: #A0A0A0"> 449</span> <span style="color: #228B22; background: #FFFFFF;">            % the right resources for example). In that case we wish to fall</span><br/>               <span style="color: #A0A0A0"> 450</span> <span style="color: #228B22; background: #FFFFFF;">            % through to running locally</span><br/>               <span style="color: #A0A0A0"> 451</span> <span style="color: #A0A0A0; background: #FFFFFF;">            warning('distcomp:remoteparfor:ParforRunningLocally', ...</span><br/>               <span style="color: #A0A0A0"> 452</span> <span style="color: #A0A0A0; background: #FFFFFF;">                ['Error caught during construction of remote parfor code.\n' ...</span><br/>               <span style="color: #A0A0A0"> 453</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 'The parfor construct will now be run locally rather than\n'...</span><br/>               <span style="color: #A0A0A0"> 454</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 'on the remote matlabpool. The most likely cause of this is\n' ...</span><br/>               <span style="color: #A0A0A0"> 455</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 'an inability to send over input arguments because of a\n'...</span><br/>               <span style="color: #A0A0A0"> 456</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 'serialization error. The error report from the caught error is:\n%s'],...</span><br/>               <span style="color: #A0A0A0"> 457</span> <span style="color: #A0A0A0; background: #FFFFFF;">                 E.getReport);</span><br/>               <span style="color: #A0A0A0"> 458</span> <span style="color: #A0A0A0; background: #FFFFFF;">            P = [];</span><br/>               <span style="color: #A0A0A0"> 459</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 460</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 461</span> <span style="color: #228B22; background: #FFFFFF;">else </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 462</span> <span style="color: #000000; background: #FFFFFF;">    P = []; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 463</span> <span style="color: #000000; background: #FFFFFF;">end </span><br/>               <span style="color: #A0A0A0"> 464</span> <span style="color: #228B22; background: #FFFFFF;">% The code below is the short-circuit code to run the parfor on the local</span><br/>               <span style="color: #A0A0A0"> 465</span> <span style="color: #228B22; background: #FFFFFF;">% machine as fast as possible. The range is not divided up, it is simply</span><br/>               <span style="color: #A0A0A0"> 466</span> <span style="color: #228B22; background: #FFFFFF;">% run as a single interval.</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 467</span> <span style="color: #000000; background: #FFFFFF;">if isempty(P) &amp;&amp; (~debug || W &lt;= 1) % do everything on the client </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 468</span> <span style="color: #000000; background: #FFFFFF;">    feval('_workspace_transparency',1) </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 469</span> <span style="color: #000000; background: #FFFFFF;">    try </span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 470</span> <a name="Line470"></a><span style="color: #000000; background: #FFFFFF;">        time1 = tic; </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 471</span> <span style="color: #000000; background: #FFFFFF;">        switch consume_supply_reduce_concat </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 472</span> <span style="color: #000000; background: #FFFFFF;">          case 0 </span><br/>               <span style="color: #A0A0A0"> 473</span> <span style="color: #A0A0A0; background: #FFFFFF;">            F(base, limit);</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 474</span> <span style="color: #000000; background: #FFFFFF;">          case 1 </span><br/><span style="color: #FF0000"> 4996.47 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 475</span> <a name="Line475"></a><span style="color: #000000; background: #FF8080;">            consume(base, limit, F(base, limit)); </span><br/>               <span style="color: #A0A0A0"> 476</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 2</span><br/>               <span style="color: #A0A0A0"> 477</span> <span style="color: #A0A0A0; background: #FFFFFF;">            F(base, limit, supply(base, limit));</span><br/>               <span style="color: #A0A0A0"> 478</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 3</span><br/>               <span style="color: #A0A0A0"> 479</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, F(base, limit, supply(base, limit)));</span><br/>               <span style="color: #A0A0A0"> 480</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 4</span><br/>               <span style="color: #A0A0A0"> 481</span> <span style="color: #A0A0A0; background: #FFFFFF;">            R = F(base, limit, identity);</span><br/>               <span style="color: #A0A0A0"> 482</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 5</span><br/>               <span style="color: #A0A0A0"> 483</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [O, R] = F(base, limit, identity);</span><br/>               <span style="color: #A0A0A0"> 484</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, O);</span><br/>               <span style="color: #A0A0A0"> 485</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 6</span><br/>               <span style="color: #A0A0A0"> 486</span> <span style="color: #A0A0A0; background: #FFFFFF;">            R = F(base, limit, supply(base, limit), identity);</span><br/>               <span style="color: #A0A0A0"> 487</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 7</span><br/>               <span style="color: #A0A0A0"> 488</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [O, R] = F(base, limit, supply(base, limit), identity);</span><br/>               <span style="color: #A0A0A0"> 489</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, O);</span><br/>               <span style="color: #A0A0A0"> 490</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 8</span><br/>               <span style="color: #A0A0A0"> 491</span> <span style="color: #A0A0A0; background: #FFFFFF;">            S = F(base, limit);</span><br/>               <span style="color: #A0A0A0"> 492</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 9</span><br/>               <span style="color: #A0A0A0"> 493</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [O, S] = F(base, limit);</span><br/>               <span style="color: #A0A0A0"> 494</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, O);</span><br/>               <span style="color: #A0A0A0"> 495</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 10</span><br/>               <span style="color: #A0A0A0"> 496</span> <span style="color: #A0A0A0; background: #FFFFFF;">            S = F(base, limit, supply(base, limit));</span><br/>               <span style="color: #A0A0A0"> 497</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 11</span><br/>               <span style="color: #A0A0A0"> 498</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [O, S] = F(base, limit, supply(base, limit));</span><br/>               <span style="color: #A0A0A0"> 499</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, O);</span><br/>               <span style="color: #A0A0A0"> 500</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 12</span><br/>               <span style="color: #A0A0A0"> 501</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [R, S] = F(base, limit, identity);</span><br/>               <span style="color: #A0A0A0"> 502</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 13</span><br/>               <span style="color: #A0A0A0"> 503</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [O, R, S] = F(base, limit, identity);</span><br/>               <span style="color: #A0A0A0"> 504</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, O);</span><br/>               <span style="color: #A0A0A0"> 505</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 14</span><br/>               <span style="color: #A0A0A0"> 506</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [R, S] = F(base, limit, supply(base, limit), identity);</span><br/>               <span style="color: #A0A0A0"> 507</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 15</span><br/>               <span style="color: #A0A0A0"> 508</span> <span style="color: #A0A0A0; background: #FFFFFF;">            [O, R, S] = F(base, limit, supply(base, limit), identity);</span><br/>               <span style="color: #A0A0A0"> 509</span> <span style="color: #A0A0A0; background: #FFFFFF;">            consume(base, limit, O);</span><br/>               <span style="color: #A0A0A0"> 510</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 511</span> <span style="color: #228B22; background: #FFFFFF;">        % Without the following, destroying this workspace asserts.</span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 512</span> <span style="color: #000000; background: #FFFFFF;">        feval('_workspace_transparency',0) </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 513</span> <span style="color: #000000; background: #FFFFFF;">        history =  {[base, limit, toc(time1)]}; % need by the next statement </span><br/>               <span style="color: #A0A0A0"> 514</span> <span style="color: #A0A0A0; background: #FFFFFF;">    catch E % work around bug in cleaning up this workspace</span><br/>               <span style="color: #A0A0A0"> 515</span> <span style="color: #A0A0A0; background: #FFFFFF;">        feval('_workspace_transparency',0)</span><br/>               <span style="color: #A0A0A0"> 516</span> <span style="color: #A0A0A0; background: #FFFFFF;">        rethrow(E)</span><br/>               <span style="color: #A0A0A0"> 517</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/><span style="color: #FF0000">&lt; 0.01 </span><span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 518</span> <a name="Line518"></a><span style="color: #000000; background: #FFFFFF;">    varargout = <a href="file57.html">results</a>(nargout); </span><br/>       <span style="color: #0000FF">      4 </span><span style="color: #000000; font-weight: bold"> 519</span> <span style="color: #000000; background: #FFFFFF;">    return </span><br/>               <span style="color: #A0A0A0"> 520</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 521</span> <span style="color: #228B22; background: #FFFFFF;">% Validate divide and next_divide after call to run locally as this isn't used in the local case</span><br/>               <span style="color: #A0A0A0"> 522</span> <span style="color: #A0A0A0; background: #FFFFFF;">if nargin &gt;= 10 &amp;&amp; ~isempty(divide)</span><br/>               <span style="color: #A0A0A0"> 523</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if isequal(divide, 'debug')</span><br/>               <span style="color: #A0A0A0"> 524</span> <span style="color: #A0A0A0; background: #FFFFFF;">        divide = divide_uniform(@(N, W) max(W, round(N/floor(sqrt(N)))));</span><br/>               <span style="color: #A0A0A0"> 525</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif isnumeric(divide)</span><br/>               <span style="color: #A0A0A0"> 526</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if ~isscalar(divide) || divide &lt; 1 || isnan(divide)</span><br/>               <span style="color: #A0A0A0"> 527</span> <span style="color: #A0A0A0; background: #FFFFFF;">            error('MATLAB:parfor:InvalidArgument', 'A numeric value for DIVIDE must be scalar and at least 1')</span><br/>               <span style="color: #A0A0A0"> 528</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 529</span> <span style="color: #A0A0A0; background: #FFFFFF;">        divide = divide_uniform(@(N, W) min(N, double(divide)*W));</span><br/>               <span style="color: #A0A0A0"> 530</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif isa(divide, 'function_handle')</span><br/>               <span style="color: #A0A0A0"> 531</span> <span style="color: #A0A0A0; background: #FFFFFF;">        switch nargin(divide)</span><br/>               <span style="color: #A0A0A0"> 532</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 1</span><br/>               <span style="color: #A0A0A0"> 533</span> <span style="color: #A0A0A0; background: #FFFFFF;">            divide = divide_uniform_min_max(@(N, W) divide(N));</span><br/>               <span style="color: #A0A0A0"> 534</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 2</span><br/>               <span style="color: #A0A0A0"> 535</span> <span style="color: #A0A0A0; background: #FFFFFF;">            divide = divide_uniform_min_max(divide);</span><br/>               <span style="color: #A0A0A0"> 536</span> <span style="color: #A0A0A0; background: #FFFFFF;">          case 3</span><br/>               <span style="color: #A0A0A0"> 537</span> <span style="color: #228B22; background: #FFFFFF;">            % Use divide as it came in.</span><br/>               <span style="color: #A0A0A0"> 538</span> <span style="color: #A0A0A0; background: #FFFFFF;">          otherwise</span><br/>               <span style="color: #A0A0A0"> 539</span> <span style="color: #A0A0A0; background: #FFFFFF;">            error('MATLAB:parfor:InvalidArgument', 'A function handle value for DIVIDE must take two or three arguments.')</span><br/>               <span style="color: #A0A0A0"> 540</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 541</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 542</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'The DIVIDE argument must be numeric, a function handle, or [].');</span><br/>               <span style="color: #A0A0A0"> 543</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 544</span> <span style="color: #228B22; background: #FFFFFF;">else</span><br/>               <span style="color: #A0A0A0"> 545</span> <span style="color: #A0A0A0; background: #FFFFFF;">    divide = divide_harmonic(@(N,W) W);</span><br/>               <span style="color: #A0A0A0"> 546</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 547</span> <span style="color: #228B22; background: #FFFFFF;">% Validate next_divide</span><br/>               <span style="color: #A0A0A0"> 548</span> <span style="color: #A0A0A0; background: #FFFFFF;">if nargin &gt;= 11 &amp;&amp; ~isempty(next_divide)</span><br/>               <span style="color: #A0A0A0"> 549</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if ~isa(next_divide, 'function_handle')</span><br/>               <span style="color: #A0A0A0"> 550</span> <span style="color: #A0A0A0; background: #FFFFFF;">        error('MATLAB:parfor:InvalidArgument', 'The NEXT_DIVIDE argument must be a function handle or [].');</span><br/>               <span style="color: #A0A0A0"> 551</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 552</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 553</span> <span style="color: #228B22; background: #FFFFFF;">% If we get here without something to run our parfor on (P) then we will</span><br/>               <span style="color: #A0A0A0"> 554</span> <span style="color: #228B22; background: #FFFFFF;">% make a localparfor "object" to run on (NOTE this is actually a struct to </span><br/>               <span style="color: #A0A0A0"> 555</span> <span style="color: #228B22; background: #FFFFFF;">% nested function handles)</span><br/>               <span style="color: #A0A0A0"> 556</span> <span style="color: #A0A0A0; background: #FFFFFF;">if isempty(P)</span><br/>               <span style="color: #A0A0A0"> 557</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if logical(bitand(consume_supply_reduce_concat, reduce_bit))</span><br/>               <span style="color: #A0A0A0"> 558</span> <span style="color: #A0A0A0; background: #FFFFFF;">        parfor_C = {consume_supply_reduce_concat, F, identity};</span><br/>               <span style="color: #A0A0A0"> 559</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 560</span> <span style="color: #A0A0A0; background: #FFFFFF;">        parfor_C = {consume_supply_reduce_concat, F};</span><br/>               <span style="color: #A0A0A0"> 561</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 562</span> <span style="color: #A0A0A0; background: #FFFFFF;">    P = localparfor(W, @make_channel, parfor_C);</span><br/>               <span style="color: #A0A0A0"> 563</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 564</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 565</span> <span style="color: #228B22; background: #FFFFFF;">% The partition:</span><br/>               <span style="color: #A0A0A0"> 566</span> <span style="color: #A0A0A0; background: #FFFFFF;">NN = divide(base, limit, W); % index by j to get the jth limit</span><br/>               <span style="color: #A0A0A0"> 567</span> <span style="color: #A0A0A0; background: #FFFFFF;">k =  length(NN);</span><br/>               <span style="color: #A0A0A0"> 568</span> <span style="color: #A0A0A0; background: #FFFFFF;">if k &lt; W</span><br/>               <span style="color: #A0A0A0"> 569</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:DivideLengthIncorrect', 'The result of DIVIDE must have length at least W.')</span><br/>               <span style="color: #A0A0A0"> 570</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 571</span> <span style="color: #A0A0A0; background: #FFFFFF;">NN0 = [base, NN(1:k-1)];     % index by j to get the jth base</span><br/>               <span style="color: #A0A0A0"> 572</span> <span style="color: #A0A0A0; background: #FFFFFF;">if ~all(NN0 &lt; NN) || NN(k) &gt; limit</span><br/>               <span style="color: #A0A0A0"> 573</span> <span style="color: #A0A0A0; background: #FFFFFF;">    error('MATLAB:parfor:DivideNotIncreasing', 'The result of DIVIDE must be strictly increasing and between BASE and LIMIT.')</span><br/>               <span style="color: #A0A0A0"> 574</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 575</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 576</span> <span style="color: #228B22; background: #FFFFFF;">% The history:</span><br/>               <span style="color: #A0A0A0"> 577</span> <span style="color: #A0A0A0; background: #FFFFFF;">history = cell(1,W);</span><br/>               <span style="color: #A0A0A0"> 578</span> <span style="color: #A0A0A0; background: #FFFFFF;">for j = 1:W</span><br/>               <span style="color: #A0A0A0"> 579</span> <span style="color: #A0A0A0; background: #FFFFFF;">    history{j} = zeros(0,3); % initialize to correct size</span><br/>               <span style="color: #A0A0A0"> 580</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 581</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 582</span> <span style="color: #A0A0A0; background: #FFFFFF;">try</span><br/>               <span style="color: #A0A0A0"> 583</span> <span style="color: #A0A0A0; background: #FFFFFF;">    R = distributed_execution(...</span><br/>               <span style="color: #A0A0A0"> 584</span> <span style="color: #A0A0A0; background: #FFFFFF;">        P, base, limit, W, k, NN, NN0, consume, supply, ...</span><br/>               <span style="color: #A0A0A0"> 585</span> <span style="color: #A0A0A0; background: #FFFFFF;">        reduce, R, concatenator, ...</span><br/>               <span style="color: #A0A0A0"> 586</span> <span style="color: #A0A0A0; background: #FFFFFF;">        consume_supply_reduce_concat, ...</span><br/>               <span style="color: #A0A0A0"> 587</span> <span style="color: #A0A0A0; background: #FFFFFF;">        consume_bit, supply_bit, reduce_bit, concat_bit);</span><br/>               <span style="color: #A0A0A0"> 588</span> <span style="color: #A0A0A0; background: #FFFFFF;">catch err</span><br/>               <span style="color: #A0A0A0"> 589</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if strcmp(err.identifier, 'distcomp:parfor:SourceCodeNotAvailable')</span><br/>               <span style="color: #A0A0A0"> 590</span> <span style="color: #228B22; background: #FFFFFF;">        % Get function on which we are operating</span><br/>               <span style="color: #A0A0A0"> 591</span> <span style="color: #A0A0A0; background: #FFFFFF;">        info = functions(F);</span><br/>               <span style="color: #A0A0A0"> 592</span> <span style="color: #A0A0A0; background: #FFFFFF;">        newErr = MException('distcomp:parfor:SourceCodeNotAvailable', ...</span><br/>               <span style="color: #A0A0A0"> 593</span> <span style="color: #A0A0A0; background: #FFFFFF;">            ['The source code (%s) for the parfor loop that is trying to execute '...</span><br/>               <span style="color: #A0A0A0"> 594</span> <span style="color: #A0A0A0; background: #FFFFFF;">             'on the worker could not be found'], info.file);</span><br/>               <span style="color: #A0A0A0"> 595</span> <span style="color: #A0A0A0; background: #FFFFFF;">        newErr = addCause(newErr, err);</span><br/>               <span style="color: #A0A0A0"> 596</span> <span style="color: #A0A0A0; background: #FFFFFF;">        throw(newErr);</span><br/>               <span style="color: #A0A0A0"> 597</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 598</span> <span style="color: #A0A0A0; background: #FFFFFF;">        throw(err);</span><br/>               <span style="color: #A0A0A0"> 599</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 600</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 601</span> <span style="color: #A0A0A0; background: #FFFFFF;">history = {}; % no timing in distributed land for now.</span><br/>               <span style="color: #A0A0A0"> 602</span> <span style="color: #A0A0A0; background: #FFFFFF;">if bitand(consume_supply_reduce_concat, concat_bit) ~= 0</span><br/>               <span style="color: #A0A0A0"> 603</span> <span style="color: #A0A0A0; background: #FFFFFF;">    S = concatenator.final();</span><br/>               <span style="color: #A0A0A0"> 604</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/>               <span style="color: #A0A0A0"> 605</span> <span style="color: #A0A0A0; background: #FFFFFF;">varargout = results(nargout);</span><br/>               <span style="color: #A0A0A0"> 606</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 607</span> <span style="color: #228B22; background: #FFFFFF;">    % Provides the varargout value for parallel_function</span><br/>               <span style="color: #A0A0A0"> 608</span> <span style="color: #A0A0A0; background: #FFFFFF;">    function C = results(nresults)</span><br/>               <span style="color: #A0A0A0"> 609</span> <span style="color: #A0A0A0; background: #FFFFFF;">    if bitand(consume_supply_reduce_concat, reduce_bit) ~= 0 % always result R in this case</span><br/>               <span style="color: #A0A0A0"> 610</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if bitand(consume_supply_reduce_concat, concat_bit) ~= 0</span><br/>               <span style="color: #A0A0A0"> 611</span> <span style="color: #A0A0A0; background: #FFFFFF;">            if nresults == 3</span><br/>               <span style="color: #A0A0A0"> 612</span> <span style="color: #A0A0A0; background: #FFFFFF;">                C = {R, S, history};</span><br/>               <span style="color: #A0A0A0"> 613</span> <span style="color: #A0A0A0; background: #FFFFFF;">            elseif nresults == 2</span><br/>               <span style="color: #A0A0A0"> 614</span> <span style="color: #A0A0A0; background: #FFFFFF;">                C = {R, S};</span><br/>               <span style="color: #A0A0A0"> 615</span> <span style="color: #228B22; background: #FFFFFF;">            else</span><br/>               <span style="color: #A0A0A0"> 616</span> <span style="color: #A0A0A0; background: #FFFFFF;">                C = {R};</span><br/>               <span style="color: #A0A0A0"> 617</span> <span style="color: #A0A0A0; background: #FFFFFF;">            end</span><br/>               <span style="color: #A0A0A0"> 618</span> <span style="color: #A0A0A0; background: #FFFFFF;">        elseif nresults == 2</span><br/>               <span style="color: #A0A0A0"> 619</span> <span style="color: #A0A0A0; background: #FFFFFF;">            C = {R, history};</span><br/>               <span style="color: #A0A0A0"> 620</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 621</span> <span style="color: #A0A0A0; background: #FFFFFF;">            C = {R};</span><br/>               <span style="color: #A0A0A0"> 622</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 623</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif bitand(consume_supply_reduce_concat, concat_bit) ~= 0 % always result S in this case</span><br/>               <span style="color: #A0A0A0"> 624</span> <span style="color: #A0A0A0; background: #FFFFFF;">        if nresults == 2</span><br/>               <span style="color: #A0A0A0"> 625</span> <span style="color: #A0A0A0; background: #FFFFFF;">            C = {S, history};</span><br/>               <span style="color: #A0A0A0"> 626</span> <span style="color: #228B22; background: #FFFFFF;">        else</span><br/>               <span style="color: #A0A0A0"> 627</span> <span style="color: #A0A0A0; background: #FFFFFF;">            C = {S};</span><br/>               <span style="color: #A0A0A0"> 628</span> <span style="color: #A0A0A0; background: #FFFFFF;">        end</span><br/>               <span style="color: #A0A0A0"> 629</span> <span style="color: #A0A0A0; background: #FFFFFF;">    elseif nresults == 1</span><br/>               <span style="color: #A0A0A0"> 630</span> <span style="color: #A0A0A0; background: #FFFFFF;">        C = {history};</span><br/>               <span style="color: #A0A0A0"> 631</span> <span style="color: #228B22; background: #FFFFFF;">    else</span><br/>               <span style="color: #A0A0A0"> 632</span> <span style="color: #A0A0A0; background: #FFFFFF;">        C = {};</span><br/>               <span style="color: #A0A0A0"> 633</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 634</span> <span style="color: #A0A0A0; background: #FFFFFF;">    end</span><br/>               <span style="color: #A0A0A0"> 635</span> <span style="color: #228B22; background: #FFFFFF;"></span><br/>               <span style="color: #A0A0A0"> 636</span> <span style="color: #A0A0A0; background: #FFFFFF;">end</span><br/></pre><p><p>Other subfunctions in this file are not included in this listing.</body></html>